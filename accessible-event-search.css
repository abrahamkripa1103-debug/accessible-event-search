
/* --- Full styles with forced light background across modes --- */
:root {
  --bg:#f9fafb;
  --text:#0b0b0c;
  --muted:#545862;
  --border:#d0d7de;
  --card:#ffffff;
  --focus:#ffbf47;
  --link:#0a5bd3;
  --shadow:0 10px 30px rgba(0,0,0,.25);
}

/* Force light theme even if user prefers dark */
@media (prefers-color-scheme: dark) {
  :root {
    --bg:#f9fafb;
    --text:#0b0b0c;
    --muted:#545862;
    --border:#d0d7de;
    --card:#ffffff;
    --link:#0a5bd3;
    --shadow:0 10px 30px rgba(0,0,0,.25);
  }
}

html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:1rem/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans"}
.container{max-width:1100px;margin:0 auto;padding:1rem}
header{padding:.75rem 0;border-bottom:1px solid var(--border)}
h1{margin:0 0 .25rem;font-size:clamp(1.4rem,2.5vw,2rem)}
.lede{color:var(--muted);margin:0 0 .75rem}
.toolbar{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;justify-content:flex-end}
.btn{appearance:none;border:2px solid var(--link);background:var(--link);color:#fff;padding:.5rem .75rem;border-radius:.6rem;cursor:pointer;font-weight:700}
.btn.secondary{background:transparent;color:var(--link)}
.btn:focus-visible{outline:3px solid var(--focus);outline-offset:2px}

/* segmented listen buttons */
.btn.segment-left{border-top-right-radius:0;border-bottom-right-radius:0;}
.btn.segment-mid{border-radius:0;border-left-width:0;border-right-width:0;}
.btn.segment-right{border-top-left-radius:0;border-bottom-left-radius:0;border-left-width:0;}
.btn.play{background:#2a8a2a;border-color:#2a8a2a;color:#fff;}
.btn.play:hover{filter:brightness(.95);}

/* Listen dropdown with toggles */
.listen-wrap{position:fixed; right:.5rem; top:.5rem; z-index:10005; display:inline-flex; align-items:center; gap:.25rem;}
.btn.split{border-top-right-radius:0;border-bottom-right-radius:0}
.btn.icon{border-top-left-radius:0;border-bottom-left-radius:0;padding:.5rem .6rem}
.listen-menu{position:absolute; right:0; left:auto; top:calc(100% + 6px); bottom:auto; min-width:280px; background:var(--bg); color:var(--text); border:1px solid var(--border); border-radius:.5rem; box-shadow:var(--shadow); padding:.25rem 0; z-index:10006; display:none; max-height:min(70vh, 480px); overflow:auto;}
.listen-menu[aria-hidden="false"]{display:block;}
.menu-item{display:flex; align-items:center; gap:.6rem; width:100%; padding:.55rem .75rem; background:none; border:0; cursor:pointer; text-align:left; font-weight:600;}
.menu-item:hover,.menu-item:focus-visible{background:var(--card); outline:3px solid var(--focus); outline-offset:-3px;}
.menu-label{flex:1;} .menu-small{font-weight:500; font-size:.92rem; color:var(--muted);}
.menu-sep{height:1px; background:var(--border); margin:.25rem 0;}

/* Switch control */
.switch{position:relative; width:44px; height:24px; border-radius:999px; border:1px solid var(--border); background:#c9cdd3; display:inline-block;}
.switch .knob{position:absolute; top:1px; left:1px; width:20px; height:20px; border-radius:999px; background:#fff; transition:transform .15s ease;}
.switch[aria-checked="true"]{background:#1f883d;} .switch[aria-checked="true"] .knob{transform:translateX(20px);}
.switch:focus-visible{outline:3px solid var(--focus); outline-offset:2px;}

form{margin:1rem 0;background:var(--card);border:1px solid var(--border);border-radius:.75rem;padding:1rem}
legend{font-weight:700;margin-bottom:.5rem}
.grid{display:grid;grid-template-columns:1fr;gap:.75rem}
@media (min-width:640px){.grid{grid-template-columns:1fr 1fr}}
.field{display:grid;gap:.25rem}
label{font-weight:600}
input[type="text"],input[type="date"]{padding:.6rem .7rem;border:1px solid var(--border);border-radius:.5rem;background:var(--bg);color:var(--text)}
input:focus-visible{outline:3px solid var(--focus);outline-offset:2px}

.results-meta{display:flex;justify-content:space-between;align-items:center;gap:.75rem;margin-top:.5rem}
.results-count{font-weight:700}
.list{list-style:none;padding:0;margin:1rem 0}
.card{border:1px solid var(--border);border-radius:.75rem;padding:1rem;background:var(--bg)}
.card+.card{margin-top:.75rem}
.event-title{font-size:1.125rem;margin:0 0 .25rem}
.meta{display:flex;flex-wrap:wrap;gap:.5rem 1rem;color:var(--muted)}
.meta dt{font-weight:700}

html[data-mode="enlarge"] body{font-size:1.25rem;line-height:1.75}
html[data-mode="enlarge"] .event-title{font-size:1.35rem}

#pageMask{position:fixed;inset:0;pointer-events:none;z-index:9999;display:none;--mask-top:40vh;--mask-height:30vh;--mask-top-stop:calc(var(--mask-top) - var(--mask-height)/2);
  --mask-bottom-start:calc(var(--mask-top) + var(--mask-height)/2);background:linear-gradient(to bottom,rgba(0,0,0,.45) 0 var(--mask-top-stop),transparent var(--mask-top-stop) var(--mask-bottom-start),rgba(0,0,0,.45) var(--mask-bottom-start) 100%)}

#ttsBar{position:fixed;right:.5rem;top:4.2rem;z-index:10001;background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:.5rem;box-shadow:var(--shadow);display:flex;align-items:center;gap:.25rem;padding:.25rem}
#ttsBar[hidden]{display:none}
.tts-btn{appearance:none;border:1px solid var(--border);background:var(--card);color:inherit;padding:.35rem .5rem;border-radius:.35rem;font-weight:700;cursor:pointer}
.tts-btn:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
.tts-group{display:flex;align-items:center;gap:.25rem}
.tts-range{width:120px;height:2rem}

#textModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:10002}
#textModal[aria-hidden="false"]{display:flex}
.text-dialog{background:var(--bg);color:var(--text);width:min(92vw,900px);max-height:86vh;border:1px solid var(--border);border-radius:.75rem;box-shadow:var(--shadow);display:flex;flex-direction:column}
.text-toolbar{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border-bottom:1px solid var(--border)}
.text-toolbar h2{margin:0;font-size:1rem}
.text-toolbar .grow{flex:1}
.text-content{padding:1rem;overflow:auto;font-size:var(--tm-fs,1.125rem);line-height:1.65}
.text-content h3{margin:.75rem 0 .25rem}
.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Force visible calendar icon */
input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(0); /* no inversion needed on light bg */
  cursor: pointer;
}
input[type="date"] {
  background-color: var(--card);
  color: var(--text);
}

/* Keep menu readable in all modes using variables (no dark override) */
.listen-menu .menu-item{ color: inherit; }
.listen-menu .menu-item .menu-label{ color: inherit; }
.listen-menu .menu-item:hover,
.listen-menu .menu-item:focus-visible{
  background:var(--card);
  outline-color:var(--focus);
}

/* Optional: darker mask shade for better contrast with UI */
:root { --mask-shade: rgba(0,0,0,.6); }
#pageMask{
  background: linear-gradient(
    to bottom,
    var(--mask-shade) 0 var(--mask-top-stop),
    transparent var(--mask-top-stop) var(--mask-bottom-start),
    var(--mask-shade) var(--mask-bottom-start) 100%
  );
}

/* Ensure Help item is visible */
.listen-menu{max-height:none;overflow:visible;}

#helpModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:10003}
#helpModal[aria-hidden="false"]{display:flex}


/* === FIX: keep switches inside menu & remove horizontal overflow === */
.listen-menu{min-width:320px; overflow-x:hidden;}
.menu-item{display:flex; align-items:center; gap:.6rem; padding-right:.9rem;}
.menu-item .menu-label{flex:1; min-width:0;}
.menu-item [role="switch"]{margin-left:auto; flex:0 0 auto;}
/* Avoid outlines pushing content outside the menu */
.menu-item:hover,.menu-item:focus-visible{outline-offset:0;}
